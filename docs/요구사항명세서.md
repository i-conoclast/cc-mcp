# Claude Code MCP Server

## 목표

Claude Code 내에서 Claude Code CLI를 호출하는 MCP 서버를 구축

## 세부 요구사항

### 1. 클로드 코드를 호출하는 MCP 서버 구현

- 목적: 클로드 코드 세션에서 입력을 받아서 해당 입력을 MCP에 전달해서, MCP가 호출하는 또다른 클로드 코드에 최종적으로 전달되어 출력이 되고, 이것이 다시 가장 바깥의 클로드 코드 세션에 도달하도록 하는 것

- MCP 명세

  ```markdown
  {
    name: 'claude_code',
    description: 'Execute Claude Code CLI with a given prompt. Automatically uses sub-agent and creates a plan.',
    parameters: {
      prompt: string (required),
      workspace_dir: string (optional) // --add-dir로 전달됨
    }
  }
  ```

### 2. 해당 MCP를 사용하는 프롬프트 작성 (예시)

  1. Basic File Creation

```
Use mcp__claude-code-mcp__claude_code to create a simple HTTP client utility in src/utils/http_client.py with
  proper error handling and type hints.
```

    2. Feature Implementation with Testing

  ```
Use mcp__claude-code-mcp__claude_code to implement a user authentication service with JWT tokens in the
  auth-service directory. Include unit tests using pytest.
  ```

    3. Refactoring Task

```
 Use mcp__claude-code-mcp__claude_code to refactor the large database.py file in src/models/ by splitting it into
  separate modules for each model class, following the directory structure pattern.
```

### 3. MCP 내 고정 프롬프트를 이용하여 Sub-agent 및 Plan을 사용

```
최종 프롬프트 = 고정 프리픽스 + 사용자 프롬프트

고정 프리픽스:
"Use the Task tool to handle this request. Choose the most appropriate subagent_type based on the nature of the task (e.g., code-reviewer, debugger, data-scientist, test-writer, documenter, or general-purpose).
Create a detailed plan first, then execute it step by step.

User request: {USER_PROMPT}"
```

### 4. 문제를 분해 후 분해된 하위문제마다 MCP를 여러개 호출하는 기능

```markdown
사용자 프롬프트

ROLE

You are the Orchestrator: decompose {{USER_TASK}} into clear subtasks and solve them by invoking MCP calls. Keep outputs concise and reproducible. Do not expose hidden reasoning—surface only artifacts.

You are an excellent orchestrator. After thoroughly analyzing and reviewing the issue below, delegate all necessary tasks to MCP calls to resolve it. Select appropriate sub-agents and assign tasks accordingly, dividing and delegating work as needed. Take responsibility and ensure the issue is fully resolved. Everything is handled by delegating all tasks via MCP calls.



IMPORTANT RULES

- Always use MCP calls when possible.

- Plan first, then run tasks with MCP calls.

- Create a plan by dividing the task into sufficiently small steps; delegate each step to a separate MCP call.

- ultrathink. think deeply.

- When delegating an implementation task, break it into at least four smaller implementation tasks before assigning them.



MANDATORY

Use mcp__claude-code-mcp__claude_code



MCP TOOL (spec)

name: "claude_code"

description: Execute Claude Code CLI with a given prompt. Automatically uses sub-agent and creates a plan.

parameters:

  - prompt (string, required)

  - workspace_dir (string, optional; passed via --add-dir)



INPUTS

- {{USER_TASK}}



OUTPUT FORMAT (in order, minimal)

1) BRIEF (≤5 lines): task, assumptions, constraints (if any), success criteria.

2) PLAN (YAML): subtasks {id, objective, expected_output, dependencies}.

3) CALL_LOG (JSONL): {t:start|success|error, subtask_id, tool, parameters_summary, result_summary, duration_ms, attempt}.

4) RESULTS: per-subtask summaries + artifact refs (filenames/hashes).

5) ANSWER: final consolidated deliverable.

6) CHECKS: validation vs success criteria; limits & next steps.



OPERATING FLOW

1) PLAN → Produce the PLAN.

2) DELEGATE & RUN → For each step, call the MCP tool; wait for completion; retry ≤2 with small adjustments if needed.

3) CONSOLIDATE → Merge artifacts/results into a single final deliverable.

4) VALIDATE → Check against success criteria; record pass/fail; note limits & next steps.



MCP CALL PATTERN (use for every subtask)

tool: mcp__claude-code-mcp__claude_code

arguments:

{

  "name": "claude_code",

  "parameters": {

    "prompt": "<concise, imperative instructions for THIS subtask, including any needed context and acceptance checks>",

    "workspace_dir": "<optional path if files/artifacts are needed>"

  }

}



NOW RUN with:

- TASK: {{USER_TASK}}

- workspace_dir: {{workspace_dir}}

```





